\section{Results}
In this section, we provide the result of hedging BTC with BTC future using different copulae and risk measures.
The results is drawn using the data from 15/12/2017 to 04/02/2021, where 15/12/2021 is the first trading day of the CME BTC future.
BTC and BTC future price are daily closing price obtained from Bloomberg in Berlin time.
BTC price here is Bitcoin Reference Rate, and BTC future price is quoted by CME. \medskip

Before estimating the optimal hedge ratio, we pre-process the data as follow.
First, we inner joint the daily BTC price and BTC future by date,
i.e. match the prices with date and discard the unmatched.
Then, we compute the log returns by $r_t = \log \frac{\text{Price}_t}{\text{Price}_{t-1}}$
We use this log return to estimate h and evaluate hâ€™s performances.

\subsection{Empirical Results}\label{subsec:empirical-results}
For each copula-risk-measure pairs,
we first calibrate copula with training data of 300 trading days by the method of moments mentioned above.
Next, we draw samples from copula and, with the samples, numerically search for the $h^*$ which minimise the risk measure.
We draw one million samples from copula for each search.
The $h^*$ is then applied to the out-of-sample data.
The out-of-sample is the data of the consecutive 5 trading day to the training data.
The $h^*$ is indexed with the first date of the out-of-sample data.
We then shift the data with 5 trading days and repeat the procedure. \medskip

%Figure~\ref{fig:Gumbel} shows the result of the Gumbel-Variance.
%One can see that the fluctuation of the hedged log returns is smaller then that of the BTC and BTC future.
%The extreme negative returns (red dots) of BTC is well managed by the hedge. \medskip
%%One can see all the combinations of copula and risk reduction objective generate a large fluctuation of returns in
%%25/09/2019 and 26/09/2019.
%%This large fluctuation is due to dependence break.

Figure~\ref{fig:Gumbel} shows the time series of out-of-sample $r^h$ using Gumbel copula with the
objective of reducing variance.
The red dots are the 30 most extreme negative returns in Bitcoin.
In the figure, we can see the downside risk of Bitcoin is well managed by the hedging procedure with NIG factor copula.
Most of the extreme losses of Bitcoin are greatly reduced by introducing the CME future in the hedged portfolio.
Two exceptions are found in 25/09/2019 and 26/09/2019, where the CME future failed to follow the large drop in Bitcoin.
%The reason of drop is unknown, but sudden drop in price is common in the cryptocurrency market.
One of the possible reason is that traders was performing rollover activities on 25-26/09/2019, which
27/09/2019 is the expiry day of the September future.
Another reason for the NIG factor copula fail of capturing the loss is dependence break.
The Kendall's tau in the training data is 0.2 higher than that of the testing data.
Other copulas suffer from the break as well. \medskip
%
\begin{figure}[th]
   \centering
   \includegraphics[width=\textwidth]{_pics/OOSreturns_compare.pdf}
   \caption{First Panel: Out of Sample Log-return of Bitcoin; Second Panel: Out of Sample Log-return of Future;
   Third Panel: Out of Sample Log-return of Hedged Portfolio by NIG factor copula with the aim of variance reduction.
   The red dots indicate the lowest 10\% return of Bitcoin, i.e. large negative moments of price.
%   Forth Panel: Out of Sample Log-return of Hedged Portfolio by $h=1$ (naive hedge).
%   Lower Panel: Out of Sample Hedged Portfolio log-returns.
%   The $h^*$ is obtained from Gumbel copula aiming at reducing variance.
%   The red dots indicate the 30 most extreme negative returns in Bitcoin.
   \href{http://www.quantlet.com/}{\includegraphics[width=20pt]{_pics/qletlogo_tr.png}}}
   \label{fig:Gumbel}
\end{figure}

Results of the other pairs are very similar, they are documented in
figure~\ref{fig:OOSRH} in the appendix.
The figure tabulates the time series of out-of-sample returns of hedged portfolio under various copulas and risk reduction objectives.\medskip

\subsection{Evaluation}
In addition to the PnL generated by different copula-risk-measure pairs,
we evaluate their performance by hedging effectiveness (HE), semivariance, and downside semivariance.
The purpose of evaluating performances of copula-risk-measure pairs beyond PnL is to assist the judgement of which pairs can estimate the optimal hedge ratio which
are suitable to hedge BTC with its future.
, in particular, HE measures the reduction of risk, the semivariance and downside semivariance relate investors' preference
(via utility function) while judging which random outcomes are better than the other.

%
%We illustrate the results in three directions, hedging effectiveness,
%ability of hedging extreme negative events in $r^S$, and the stability of $h^*$.

%\begin{itemize}
%   \item  Hedging Effectiveness
%   \begin{itemize}
%     \item Kick out Frank for its ineffectiveness; Alternative to a one-parameter symmetric Archimedean copula is Plackett;
%       \natp{\em [The issue with the Frank copula is that is has no
%         tails. A scatterplot looks like a strip, there is no
%         concentration in the tails. For CDO pricing (and this is what
%         I remember from my PhD studies) this poses problems as you
%         move from senior to junior tranches. Here, I suppose it just
%         does not capture the empirical behaviour of the data.
%         ]}
%     \item Differences among combinations of copula and risk reduction objective are small;
%     \item None of the combination can escape from the structural break point (dependence of training is stronger then that of testing). (The bump in 25-26th Sept 2019)
%     \item The best performing RRO of a particular risk measure in out-of-sample $r^h$ is not necessarily same, e.g.
%      VaR 95\% as RRO (with Gumbel copula) can generate the lowest out-of-sample ES 99\%.
%   \end{itemize}
%   \item Ability to hedge extreme events in $r^S$
%   \begin{itemize}
%     \item The extreme events in $r^S$ are well managed by the hedge.
%     The magnitudes of loss in $r^h$ is much smaller than that of $r^h$. (Visually seen from the time series of $r^h$)
%     \item None of the combination can escape from the structural break point (dependence of training is stronger then that of testing)
%   \end{itemize}
%   \item Stability of $h^\ast$
%   \begin{itemize}
%     \item Gumbel gives high $h$ all the time; the extreme events are "hedged" ex-ante.
%     \item ES 99\% and VaR 99\% as risk reduction objective are too sensitive to extremes in training data;
%     Large changes in $h$ are suggested in response to extremes training data, while the testing data are less extreme;
%     \item ERM can be seen as a smoothed risk measure focusing in the lower tail of $r^h$; Less sensitive to rare events; Suggested.
%   \end{itemize}
%\item \end{itemize}

\subsubsection{Hedging Effectiveness}\label{subsubsec:hedging-effectiveness}
The hedging effectiveness (HE) measures the reduction of portfolio risk.
This notion of evaluating of hedging performance was proposed by \citet{ederington1979hedging} in the context of hedging the newly introduced
organized futures market.\medskip

HE is defined as
\begin{align}
  1- \frac{\rho(r^h)}{\rho(r^S)},
  \end{align}
where $\rho$ is a risk measure.

We measure the HE of copula-risk-measure pairs according to the risk measure, for example we measure the
HE of Gaussian-ES99\% pair by
\begin{align}
  1- \frac{\text{ES}_{99\%}(r^h)}{\text{ES}_{99\%}(r^S)},
  \end{align}
where $r^h$ is out-of-sample return generated by Gaussian-ES99\%, and $r^S$ is the out-of-sample log return of BTC. \medskip

\begin{figure}[H]
   \centering
   \includegraphics[height=24cm]{_pics/Out of Sample Hedging Effectiveness.png}
   \caption{Out of Sample Hedging Effectiveness Box-plot.
   The HEs are obtained from a set of out-of-sample data,
   each set consists 30 days log returns of Bitcoin and CME future.
   \href{http://www.quantlet.com/}{\includegraphics[width=20pt]{_pics/qletlogo_tr.png}}}
   \label{fig:OOSHE}
\end{figure}

The box-plots in figure \ref{fig:OOSHE} show the out-of-sample hedging effectiveness of different copulas under various risk
reduction objectives across testing datasets.
Observe that most of the copulae perform well.
The average HE of copulas and risk reduction objectives is higher than 60\% except for Frank-copula.
However, the HEs vary a lot in different testing data.
In some instances, the HE can be as low as 10\%.
This reflects the highly violate nature of cryptocurrencies:
the optimal hedge ratio in the training data deviates from that of testing data.
There is a large literature about structural break points and time changing dependence, to name a few
\citet{hafner2012dynamic}, \citet{patton2006modelling}, \citet{creal2008general},
\citet{engle2002dynamic}, \citet{giacomini2009inhomogeneous}, and also
\citet{manner2012survey}.\medskip


\subsubsection{Root Mean Squared Error and Semivariance}
Root mean squared error (RMSE) and semivariance (SV) are special cases of the Bernel Stone's generalized risk measure \citep{stone1973general}.
The purpose of applying a generalized risk meausre is to choose among copula-risk-measure pairs in a common ground. \medskip

The Bernel Stone's generalized risk measure is
\begin{align*}
    \rho(F) = \int_{-\infty}^{\gamma(F)} \left|x-\eta(F)\right|^\alpha dF(x),
    \end{align*}
where $F$ is the distribution of the uncertain return, parameters $\alpha$ is chosen to represent preferences of investors,
$\eta(F)$ is a reference level of wealth from which deviations are measured, and $\gamma(F)$ is a range parameter that specifies the range of deviations to be included.\medskip

\citet{fishburn1977mean} justifies the usage of generalized risk measure (with his $\alpha$-$t$ model) by connecting the measure with Von Neumann-Morgenstern utility theorem, see also \citet{bawa1975optimal, bawa1978safety}
and \citet{morgenstern1953theory}.
We argue that evaluation of hedging performance of a crypto portfolio does not differ from this classical framework:
crypto investors maximise expected utility with given utility functions.
See \citet{chen2003futures} for a review of hedging performance evaluation.
Vast body of recent literature remain in the framework, to name a few, \citet{sebastiao2020bitcoin, deng2020minimum, cui2020composite, oglend2020futures}. \medskip
%Hedging futures performance with denoising and noise-assisted strategies
%Minimum-variance hedging of Bitcoin inverse futures

For root mean squared error, we choose $\gamma(F)=\infty$ and $\eta(F)=0$, i.e. we consider a full range, from $-\infty$ to $\infty$, of deviations to our target
of zero PnL.
For semivariance (SV), we choose $\gamma(F)=0$ and $\eta(F)=0$.
The setting of semivariance represents our focus on the downside risk.
Sometimes, SV is called lower partial moment. \medskip

Therefore, for each pair of copula-risk-measure, we calculate
\begin{align*}
    \text{RMSE} = \operatorname{\mathsf{E}}\{(r-0)^2\}^{1/2},
    \end{align*}
and
\begin{align*}
    \text{SV} = \operatorname{\mathsf{E}}\left[r - \operatorname{\mathsf{E}(r)}\}^2 | r \leq 0 \right]
\end{align*}

The result is shown in plot.
The RMSE of the copula-risk-measure pairs is ranging from 0.35 to 0.55.
The smallest RMSE is generated by the pair Gaussian-Vairance, while a number of other pairs generate very similar results.
The Frank copula's RMSEs are high no matter the risk measures.
This suggests Frank should not be used to model the dependency structure of BTC and BTC future.\medskip

RMSEs of VaR 99\% and ES 99\% across different copulae are also inferior to that of other risk measures.
In particular, Gumbel-, NIG factor-and Gaussian mix Independence-copula together with VaR 99\% and ES 99\%
generate higher RMSEs.
We will discuss this result in the robustness part.

%\begin{figure}[t]
%\includegraphics[width=\textwidth, height=\textheight]{_pics/Out of Sample Hedging Effectiveness.png}
%  \caption{}
%\label{out of Sample Hedging Effectieness}
%\end{figure}

%\subsubsection{Semivariance}
%Semivariance is a measurement of data to estimate the potential downside risk of an investment portfolio.
%It is the dispersion of all observations that is smaller than the mean or a certain threshold.
%Semivariance is discussed by many, to name a few,
%Markowitz (1959), Mao (1970a, 1970b),
%Mao (1970a), Hogan and Warren (1972, 1974).
%provide the theoretical justifications for semivariance.


%\subsection{Stability of $h^*$}

\section{Conclusion and Discussion}
We conclude that the usage of copulae

\subsection{About Frank Copula}\label{subsec:Frank}
Frank-copula, in general, is not a good choice to model financial data.
We can see from figure~\ref{fig:Frank} that the Frank copula is not fitting the Bitcoin and its future visually, no matter
which optimization procedure is being deployed.
The samples of Frank diffuse like a strip with parallel edge when the parameter $\theta$ decrease (samples are being less dependent).
This makes Frank copula not a a good fit to the data.

\begin{figure}[th]
   \centering
   \includegraphics[width=\textwidth]{_pics/Frank.pdf}
   \caption{Comparison of Frank Copula Samples and Pseudo Observations of Bitcoin and CME Future Returns.
   \href{http://www.quantlet.com/}{\includegraphics[width=20pt]{_pics/qletlogo_tr.png}}}
   \label{fig:Frank}
\end{figure} \medskip

Aside from the Frank-copula, the HEs of various combination of copula and risk reduction objective are very similar.
This is an expected result as the portfolio consists only two assets.


\input{robustness.tex}



%We measure the stability of $h^*$ by sum of absolute change
%\begin{align}
%    \sum_{t=1}^T|h_t - h_{t-1}|.
%    \end{align}
%
%Adjustment of portfolio weights induces price slippage (ref) and transaction cost.
%From figure \ref{SAD} we know the NIG factor copula with variance as risk reduction objective generates the smallest
%sum of absolute change in OHR.
%
%\begin{figure}[!th]
%   \centering
%   \includegraphics[width=\textwidth]{_pics/Sum of absolute change in OHR.png}
%   \caption{Sum of Absolute Change in OHR.
%   \href{http://www.quantlet.com/}{\includegraphics[width=20pt]{_pics/qletlogo_tr.png}}}
%   \label{fig:SAD}
%\end{figure}

%\input{table.tex}


